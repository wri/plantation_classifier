schema: '2.0'
stages:
  prep_features:
    cmd: python src/stage_prep_features.py --params=params.yaml
    deps:
    - path: src/features/ModelData.py
      hash: md5
      md5: 5572337e158d124e7f3f0b20877caad4
      size: 3309
    - path: src/features/create_xy.py
      hash: md5
      md5: 2543c85221c5cff45c75d3a14e2a3a9d
      size: 19693
    - path: src/stage_prep_features.py
      hash: md5
      md5: 3af60a8efc60031b4770b33cedf5fea6
      size: 2189
    params:
      params.yaml:
        base:
          log_level: DEBUG
          random_state: 121
          config: config.yaml
        data_condition:
          classes: 4
          ard_subsample: 4
          subset_fraction: 0.1
          test_split: 20
          train_split: 80
          val_split: 25
          modelData_path: data/train/modelData.pkl
        data_load:
          download_data: false
          bucket_name: restoration-monitoring
          folder_prefix: plantation-mapping/data/train/
          local_prefix: data/
          ceo_survey:
          - v08
          - v15
          - v18
          - v19
          - v20
          data_prefix_list:
          - slope
          - s1
          - s2
          - dem
          - features-ckpt-2023-02-09
          - labels
          - ard
          - features-ard
    outs:
    - path: data/train/modelData.pkl
      hash: md5
      md5: b253b4eaa39a932f5cec98b6da5b1c02
      size: 235334843
  load_data:
    cmd: python src/stage_load_data.py --params=params.yaml
    deps:
    - path: src/stage_load_data.py
      hash: md5
      md5: b5e6602d43707febb306aa8608238ba1
      size: 1050
    params:
      params.yaml:
        base:
          log_level: DEBUG
          random_state: 121
          config: config.yaml
        data_load:
          download_data: false
          bucket_name: restoration-monitoring
          folder_prefix: plantation-mapping/data/train/
          local_prefix: data/
          ceo_survey:
          - v08
          - v15
          - v18
          - v19
          - v20
          data_prefix_list:
          - slope
          - s1
          - s2
          - dem
          - features-ckpt-2023-02-09
          - labels
          - ard
          - features-ard
  select_features_hyperparams:
    cmd: python src/stage_select_and_tune.py --params=params.yaml
    deps:
    - path: data/train/modelData.pkl
      hash: md5
      md5: b253b4eaa39a932f5cec98b6da5b1c02
      size: 235334843
    - path: src/features/feature_selection.py
      hash: md5
      md5: f016e7dc2af2ef5cd069f452327665ea
      size: 5845
    params:
      params.yaml:
        base:
          log_level: DEBUG
          random_state: 121
          config: config.yaml
        data_condition:
          classes: 4
          ard_subsample: 4
          subset_fraction: 0.1
          test_split: 20
          train_split: 80
          val_split: 25
          modelData_path: data/train/modelData.pkl
        select:
          select_features: false
          selected_features_path: data/train/selected_features.json
          max_features: 40
          fs_analysis: feat_imp
        train:
          model_dir: models/
          model_name: models/model.joblib
          estimator_name: cat
          cv: 3
          tuning_metric: balanced_accuracy
          testing_metrics: accuracy balanced_accuracy precision recall f1 roc_auc
            log_loss
          estimators:
            rfc:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            svm:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            lgbm:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            xgb:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            logreg:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            cat:
              importance_metric: shap
              use_class_weights: true
              use_defaults: true
              param_grid:
                loss_function: MultiClass
                random_state: 121
                logging_level: Silent
    outs:
    - path: data/train/selected_features.json
      hash: md5
      md5: 2df8d99ccf7b6ee08df0912143f7f9ed
      size: 366
    - path: src/evaluation/best_params.json
      hash: md5
      md5: 5627006a412d769b1b1c112ff2ed8079
      size: 14
  train_model:
    cmd: python src/stage_train_model.py --params=params.yaml
    deps:
    - path: data/train/modelData.pkl
      hash: md5
      md5: b253b4eaa39a932f5cec98b6da5b1c02
      size: 235334843
    - path: data/train/selected_features.json
      hash: md5
      md5: 2df8d99ccf7b6ee08df0912143f7f9ed
      size: 366
    - path: src/evaluation/best_params.json
      hash: md5
      md5: 5627006a412d769b1b1c112ff2ed8079
      size: 14
    - path: src/model/train.py
      hash: md5
      md5: 5035f7b40783e0dfe03a284ec31961fe
      size: 3575
    - path: src/stage_train_model.py
      hash: md5
      md5: 441d970ca549b5e40e755de2beac2a99
      size: 1877
    params:
      params.yaml:
        base:
          log_level: DEBUG
          random_state: 121
          config: config.yaml
        data_condition:
          classes: 4
          ard_subsample: 4
          subset_fraction: 0.1
          test_split: 20
          train_split: 80
          val_split: 25
          modelData_path: data/train/modelData.pkl
        train:
          model_dir: models/
          model_name: models/model.joblib
          estimator_name: cat
          cv: 3
          tuning_metric: balanced_accuracy
          testing_metrics: accuracy balanced_accuracy precision recall f1 roc_auc
            log_loss
          estimators:
            rfc:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            svm:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            lgbm:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            xgb:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            logreg:
              importance_metric: shap
              use_class_weights: true
              param_grid:
            cat:
              importance_metric: shap
              use_class_weights: true
              use_defaults: true
              param_grid:
                loss_function: MultiClass
                random_state: 121
                logging_level: Silent
    outs:
    - path: models/model.joblib
      hash: md5
      md5: 6fd196f6fd41acdd8831449e3326e92f
      size: 2643107
